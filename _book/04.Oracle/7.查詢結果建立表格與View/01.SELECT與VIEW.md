<h1 id="top">目錄</h1>

- [1. 利用 SELECT 新增資料](#s1)
- [2. SELECT 範例](#s2)
- [3. View 概論](#s3)
- [4. View 的管理](#s4)
- [5. View 內容異動](#s5)
- [6. 建立唯讀 View](#s6)
- [7. View 範例](#s7)

---

# <a id='s1' class='md-title' href='#top'>1. 利用 SELECT 新增資料</a>

- 建立新表格並將查詢結果插入

```sql
CREATE TABLE table_name AS
SELECT column1, column2,...
FROM existing_table_name
WHERE ....;
```

- 將查詢結果插入已存在表格

```sql
INSERT INTO table2 (column1, column2, column3, ...)
SELECT column1, column2, column3, ...
FROM table1
WHERE condition;
```

# <a id='s2' class='md-title' href='#top'>2. SELECT 範例</a>

- 建立表格

```sql
-- CREATE TABLE AS SELECT
-- 建立BOOK_BACK表格並將書價>=1000的書名、定價、作者、出版日期插入
---- 建立表格並將 BOOK 資料複製過去
CREATE TABLE BOOK_BACK AS
SELECT BOOK_NAME, PRICE, AUTHOR, PUBLICATION_DATE FROM BOOK
WHERE PRICE >= 1000;
```

- 錄入新資料

```sql
-- INSERT INTO SELECT
-- 將書價 < 1000的書名、定價、作者、出版日期插入到已存在的BOOK_BACK表格內
INSERT INTO BOOK_BACK
SELECT BOOK_NAME, PRICE, AUTHOR, PUBLICATION_DATE FROM BOOK
WHERE PRICE < 1000;
```

# <a id='s3' class='md-title' href='#top'>3. View 概論</a>

- view (視表) 可說是一個虛擬表格
- 使用 SELECT 語法來建立 view
- view 永遠都呈現最新內容

  - 每次 user 查詢 view 時,資料庫系統都會依照該 SELECT 語法重新建立一次 view 內容

- 可建立唯讀/非唯讀的 view

- 沒有表格就建立新的，還可以當作個判斷 這樣更好一些，不會 error

# <a id='s4' class='md-title' href='#top'>4. View 的管理</a>

- 建立 view

```sql
CREATE VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
WHERE condition;
```

- 建立或取代 view

```sql
CREATE OR REPLACE VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
WHERE condition;
```

- 查詢 view

```sql
SELECT column1, column2, ... FROM view_name;
```

- 刪除 view

```sql
DROP VIEW view_name;
```

# <a id='s5' class='md-title' href='#top'>5. View 內容異動</a>

- 可以將資料新增至 view 所代表的表格內,也可查詢到
- 將 FK 設定為 NULL,就不符合建立 view 時的查詢條件,所以無法透過 view 查詢到,必須查詢真實表格
- 不符合 view 條件的資料,也就無法透過 view 刪除
- `不建議使用，也很少用`

# <a id='s6' class='md-title' href='#top'>6. 建立唯讀 View</a>

- 建立唯讀 view

```sql
CREATE OR REPLACE VIEW view_name AS
SELECT column1, column2, ...
FROM table_name
WHERE condition
WITH READ ONLY;
```

- 唯讀 view 的內容無法異動,會發生錯誤

# <a id='s7' class='md-title' href='#top'>7. View 範例</a>

- `建立` view

```sql
-- 建立view
CREATE VIEW BOOK_VIEW AS
SELECT ISBN, BOOK_NAME, PRICE, AUTHOR, PUBLICATION_DATE, B.PUBLISHER_ID, PUBLISHER_NAME, PHONE
FROM BOOK B
JOIN PUBLISHER P ON B.PUBLISHER_ID = P.PUBLISHER_ID
WHERE PRICE < 1000;
```

- `建立`或`取代` view

```sql
-- 建立或取代view
CREATE OR REPLACE VIEW BOOK_VIEW AS
SELECT ISBN, BOOK_NAME, PRICE, AUTHOR, PUBLICATION_DATE, B.PUBLISHER_ID, PUBLISHER_NAME, PHONE
FROM BOOK B
JOIN PUBLISHER P ON B.PUBLISHER_ID = P.PUBLISHER_ID;
```

- `查詢` view

```sql
-- 查詢view
SELECT * FROM BOOK_VIEW;
```

- `刪除` view

```sql
-- 刪除view
DROP VIEW BOOK_VIEW;
```

- `新增` view `資料`

```sql
-- VIEW CONTENT
-- 可以將資料新增至view所代表的表格內，也可查詢到
INSERT INTO BOOK_VIEW (ISBN, BOOK_NAME, PRICE, PUBLISHER_ID)
VALUES ('1234567890123', 'TEST_BOOK1', 250, 'P001');
```

- `設定` view `查詢條件`

```sql
-- 將FK設定為NULL，就不符合建立view時的查詢條件，所以無法透過view查詢到，必須查詢真實表格
UPDATE BOOK_VIEW SET PUBLISHER_ID = NULL WHERE ISBN = '1234567890123';
SELECT * FROM BOOK_VIEW; -- 查詢不到修改完的資料
SELECT * FROM BOOK; -- 必須查詢真實表格
```

- 不符合 view 條件的資料，就無法透過 view 刪除

```sql
-- 不符合view條件的資料，就無法透過view刪除
DELETE FROM BOOK_VIEW WHERE ISBN = '1234567890123';
DELETE FROM BOOK WHERE ISBN = '1234567890123';
```

- 設定 View 表格`唯讀`

```sql
-- READ-ONLY VIEW
CREATE OR REPLACE VIEW BOOK_VIEW AS
SELECT ISBN, BOOK_NAME, PRICE, AUTHOR, PUBLICATION_DATE, B.PUBLISHER_ID, PUBLISHER_NAME, PHONE
FROM BOOK B
JOIN PUBLISHER P ON B.PUBLISHER_ID = P.PUBLISHER_ID
WITH READ ONLY;
```

- `唯讀` view 的內容`無法異動`，會發生錯誤

```sql
-- 唯讀view的內容無法異動，會發生錯誤
INSERT INTO BOOK_VIEW (ISBN, BOOK_NAME, PUBLISHER_ID)
VALUES ('9876543210123', 'TEST_BOOK2', 'P002');
```
