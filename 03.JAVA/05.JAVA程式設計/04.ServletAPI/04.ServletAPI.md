<h1 id="top">目錄</h1>

- [1. 範例 1: doGet() doPost()](#s1)
- [2. 範例 2: getParameter()](#s2)
- [3. 文件分享位置](#s3)
- [4. 部屬檔(\*.xml)](#s4)
- [5. 測試部屬檔實體次數](#s5)

---

1. - req、res 只是內部在用的變數名稱
   - 都是抽象介面、抽象類別。強迫繼承

![05-04_01_p25](./image/05-04_01_p25.png)

![05-04_06_code](./image/05-04_06_code.png)

![05-04_02_p43](./image/05-04_02_p43.png)

![05-04_03_p42](./image/05-04_03_p42.png)

![05-04_04_p26](./image/05-04_04_p26.png)

- - 有抽象方法 一定要宣告成抽象類別
  - 抽象類別不一定要是抽象方法
  - doGet()、goPost() 都是間接方法

![05-04_08_p27](./image/05-04_08_p27.png)

- protected 保護不同套件的子類別用的
- exception 可見度是一樣或更小

![05-04_07_p28](./image/05-04_07_p28.png)

![05-04_09_p29](./image/05-04_09_p29.png)

![05-04_10_p438](./image/05-04_10_p438.png)

![05-04_11_p30](./image/05-04_11_p30.png)

- - post 有請求 content

![05-04_12_p31](./image/05-04_12_p31.png)

![05-04_13_p15](./image/05-04_13_p15.png)

- - 對應前端欄位的 name，文字大寫需相同

![05-04_14_p31](./image/05-04_14_p31.png)

![05-04_15_p73](./image/05-04_15_p73.png)

- - `Enumeration` 推薦使用

![05-04_17_p74](./image/05-04_17_p74.png)

![05-04_18_p62](./image/05-04_18_p62.png)

- - 先使用 `req.setCharacterEncoding('Big5');`
    - 只對 post 有效果

![05-04_19_p250](./image/05-04_19_p250.png)

![05-04_20_p251](./image/05-04_20_p251.png)

- - 使用的 server 不同的話，想辦法找出 `useBodyEncodingForURL="true"` 相關的設定並往 post 靠

![05-04_21_p252](./image/05-04_21_p252.png)

- - 讓參數發送時，可以自訂輸出的字元編碼(即與 post 靠攏)
  - 為了讓 `get` 可使用 `req.setCharacterEncoding()` 方法

![05-04_22_p253](./image/05-04_22_p253.png)

![05-04_23_p254](./image/05-04_23_p254.png)

![05-04_24_p255](./image/05-04_24_p255.png)

- - 上限時需要將 web.xml 的 true 關閉，否則站台一打開就可通過 tomcat 目錄進入

![05-04_25_p292](./image/05-04_25_p292.png)

![05-04_26_p291](./image/05-04_26_p291.png)

![05-04_28_code](./image/05-04_28_code.png)

![05-04_29_p32](./image/05-04_29_p32.png)

![05-04_30_p38](./image/05-04_30_p38.png)

![05-04_31_p33](./image/05-04_31_p33.png)

- - 依照格是嚴格設定好，資料就可自動抓取目錄中的值
  - `http://localhost:8081/IBM_9/HelloWorld` 表示可直接這樣打開 java

![05-04_32_p34](./image/05-04_32_p34.png)

![05-04_33_code](./image/05-04_33_code.png)

![05-04_34_p35](./image/05-04_34_p35.png)

![05-04_35_p293](./image/05-04_35_p293.png)

![05-04_36_p62](./image/05-04_36_p62.png)

- - 即啟動時就能知道錯誤

![05-04_37_p36](./image/05-04_37_p36.png)

![05-04_38_p38](./image/05-04_38_p38.png)

- - xml 描述檔中最重要的就是圖片中兩點

![05-04_39_p37](./image/05-04_39_p37.png)

![05-04_40_p295](./image/05-04_40_p295.png)

- - web-app 為主體

![05-04_41_p297](./image/05-04_41_p297.png)

![05-04_42_code](./image/05-04_42_code.png)

- - 一開始部屬檔(\*.xml)就已經先載入，故如果命名的 `<url-pattern>/hello.html</url-pattern>` 不可有真的 html 與之同名，不然真的 html 除非重新定義新名位置，否則永遠無法打開

![05-04_43_p39](./image/05-04_43_p39.png)

![05-04_44_p438](./image/05-04_44_p438.png)

![05-04_45_code](./image/05-04_45_code.png)

![05-04_46_p18](./image/05-04_46_p18.png)

![05-04_47_p3](./image/05-04_47_p3.png)

![05-04_48_p11](./image/05-04_48_p11.png)

# <a id='s1' class='md-title' href='#top'>1. 範例 1: doGet() doPost()</a>

```cs
範例程式: "/SL314/WebContent/test.html"
```

```html
<html>
  <head>
    <title>上 傳 圖 檔</title>
  </head>
  <body>
    <form action="UploadTest" method="post" enctype="multipart/form-data">
      <input type="file" name="upfile1" />
      <br />
      <input type="file" name="upfile2" />
      <input type="submit" value="上傳" />
    </form>
  </body>
</html>
```

```cs
範例程式: "/SL314/src/servlet_examples/HelloWorld.java"
```

```java
package servlet_examples;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorld extends HttpServlet {
  // method=post
  public void doGet(HttpServletRequest req, HttpServletResponse res)
               throws ServletException, IOException {
    doGet(req, res);
  }
  public void doPost(HttpServletRequest req, HttpServletResponse res)
                               throws ServletException, IOException {

    res.setContentType("text/html; charset=Big5");
  PrintWriter out = res.getWriter();

  out.println("<HTML>");
  out.println("<HEAD><TITLE>Hello World</TITLE></HEAD>");
  out.println("<BODY>");
  out.println("<BIG>Hello World , 世界你好!</BIG>");
  out.println("</BODY></HTML>");
  }
}
```

```cs
Hello World , 世界你好!
```

# <a id='s2' class='md-title' href='#top'>2. 範例 2: getParameter()</a>

```cs
範例程式: "/SL314/src/servlet_examples/Hello.java"
```

```java
package servlet_examples;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class Hello extends HttpServlet {

  public void doGet(HttpServletRequest req, HttpServletResponse res)
                               throws ServletException, IOException {
      req.setCharacterEncoding("Big5");
      res.setContentType("text/html; charset=Big5");
      PrintWriter out = res.getWriter();

      String name = req.getParameter("name");
      out.println("<HTML>");
      out.println("<HEAD><TITLE>Hello, " + name + "</TITLE></HEAD>");
      out.println("<BODY>");
      out.println("Hello, 你好: " + name);
      out.println("</BODY></HTML>");
  }

  public String getServletInfo() {
    return "A servlet that knows the name of the person to whom it's" +
           "saying hello";
  }
}
```

```cs
範例程式: "/SL314/WebContent/form.html"
```

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=BIG5" />
    <title>form.html</title>
  </head>
  <body>
    <form method="get" action="Hello">
      請輸入您的名字!
      <input type="TEXT" name="name" value="peter1吳永志" />
      <p>
        <input type="SUBMIT" />
      </p>
    </form>
  </body>
</html>
```

![05-04_16_code](./image/05-04_16_code.png)

# <a id='s3' class='md-title' href='#top'>3. 文件分享位置</a>

- - Tomcat 設定，已經調整好的檔案

![05-04_27_doc](./image/05-04_27_doc.png)

# <a id='s4' class='md-title' href='#top'>4. 部屬檔(\*.xml)</a>

- 註冊名稱是為了讓伺服器幫忙實體，故每個 class 最好創建獨立的實體

```xml
<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- 以下為 Servlet2.3 、 Servlet2.4 、 Servlet2.5 、 Servlet3.0 、 Servlet3.1 、 Servlet4.0 各個Servlet版本的部署描述檔 web.xml 的頂層標籤 -->

<!--
<!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd">
<web-app>
-->


<!--
<web-app xmlns="http://java.sun.com/xml/ns/j2ee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
                      http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
  version="2.4">
-->


<!--
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
                      http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
  version="2.5">
-->


<!--
<web-app xmlns="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
                      http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
  version="3.0"
  metadata-complete="false">
-->


<!--
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
  version="3.1"
  metadata-complete="false">
-->


<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
  version="4.0"
  metadata-complete="false">


    <!-- <request-character-encoding>Big5</request-character-encoding> -->
    <!-- 使用資料庫連線池 DataSource-JNDI的設定 -->
    <resource-ref>
        <description>DB Connection</description>
        <res-ref-name>jdbc/TestDB</res-ref-name>
        <res-type>javax.sql.DataSource</res-type>
        <res-auth>Container</res-auth>
    </resource-ref>

    <!-- 註冊名稱是為了讓伺服器幫忙實體，故每個class最好創建獨立的實體 -->

    <servlet>                           <!-- 已經無法以註冊名稱(http://localhost:8081/IBM/servlet/hi)的方式執行,因為Invoker servlet的功能在Tomcat 7.x 已經被移除 -->
        <servlet-name>hi</servlet-name>
        <servlet-class>Hello</servlet-class>
    </servlet>

    <servlet-mapping>                   <!-- 明確對應 http://localhost:8081/IBM/hello.html -->
        <servlet-name>hi</servlet-name>
        <url-pattern>/hello.html</url-pattern>
    </servlet-mapping>

    <servlet-mapping>                   <!-- 前置路徑對應 http://localhost:8081/IBM/hello.html/xxxxx -->
        <servlet-name>hi</servlet-name>
        <url-pattern>/hello.html/*</url-pattern>
    </servlet-mapping>

    <servlet-mapping>                   <!-- 延伸檔名對應 http://localhost:8081/IBM/xxx/yyy/zzz.mm-->
        <servlet-name>hi</servlet-name>
        <url-pattern>*.mm</url-pattern>
    </servlet-mapping>


    <!-- HelloWorld的第二個註冊名稱與mapping -->
    <servlet>
        <servlet-name>HelloWorld</servlet-name>
        <servlet-class>HelloWorld</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>HelloWorld</servlet-name>
        <url-pattern>/HelloWorld</url-pattern>
    </servlet-mapping>


    <!-- Hello的註冊名稱與mapping -->
    <servlet>
        <servlet-name>Hello</servlet-name>
        <servlet-class>Hello</servlet-class>
    </servlet>
    <servlet-mapping>
        <servlet-name>Hello</servlet-name>
        <url-pattern>/Hello</url-pattern>
    </servlet-mapping>



<!-- HTTP身份驗證-Basic  HTTP Basic Authentication  , 【username 為 tomcat ; password 為 tomcat】【可查看tomcat-users.xml】-->
<!--
    <security-constraint>
        <web-resource-collection>
            <web-resource-name>
                SecretProtection
            </web-resource-name>
            <url-pattern>
                /*
            </url-pattern>

            <http-method>
                GET
            </http-method>
            <http-method>
                POST
            </http-method>
        </web-resource-collection>
        <auth-constraint>
            <role-name>
                tomcat
            </role-name>
        </auth-constraint>
    </security-constraint>

    <login-config>
        <auth-method>
            BASIC
        </auth-method>
        <realm-name>
            Default
        </realm-name>
    </login-config>

    <security-role>
        <role-name>
            tomcat
        </role-name>
    </security-role>
-->


<!-- error-page 錯誤網頁 -->
<!--
    <error-page>
        <error-code>
            400
        </error-code>
        <location>
            /error.html
        </location>
    </error-page>

    <error-page>
        <error-code>
            404
        </error-code>
        <location>
            /error.html
        </location>
    </error-page>

    <error-page>
        <error-code>
            500
        </error-code>
        <location>
            /error.html
        </location>
    </error-page>

    <error-page>
        <exception-type>
            javax.servlet.ServletException
        </exception-type>
        <location>
            /error.html
        </location>
    </error-page>
-->

</web-app>


<!-- Servlet 3.0 開始的部署描述檔 web.xml 的頂層標籤 有一個 metadata-complete 屬性，該屬性指定當前的部署描述檔 web.xml 是否是完全的。 -->
<!-- 預設為false -->
<!-- 如果設置為 true，則在部署時將只依賴 web.xml，將忽略所有的Anotation註解（同時也會跳過 web-fragment.xml 的掃瞄，亦即禁用可插性支持）-->
<!-- 如果在web.xml、Anotation、web-fragment.xml中所設定的Servlet有同名的註冊名稱，則以web.xml中的設定為主（順序為web.xml -> Anotation -> web-fragment.xml）-->
```

# <a id='s5' class='md-title' href='#top'>5. 測試部屬檔實體次數</a>

```java
//package servlet_examples;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorld extends HttpServlet {

  int count = 0;

  public void doGet(HttpServletRequest req, HttpServletResponse res)
                               throws ServletException, IOException {
    doPost(req, res);

  }

  public void doPost(HttpServletRequest req, HttpServletResponse res)
                                throws ServletException, IOException {

    res.setContentType("text/html; charset=Big5");
    PrintWriter out = res.getWriter();

    out.println("<HTML>");
    out.println("<HEAD><TITLE>Hello World</TITLE></HEAD>");
    out.println("<BODY>");
    out.println("<BIG>Hello World , 世界你好2 !</BIG>"+(++count));
    out.println("</BODY></HTML>");
  }
}
```

![05-04_49_code](./image/05-04_49_code.png)
