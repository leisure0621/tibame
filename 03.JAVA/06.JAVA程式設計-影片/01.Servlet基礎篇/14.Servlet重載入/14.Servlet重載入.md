<h1 id="top">目錄</h1>

- [1. Servlet Reloading (Servlet 重載入)](#s1)
- [2. tomcat-users.xml 設定重載入](#s2)
- [3. 手動 Reload 或 Stop](#s3)
- [4. 重載入測試](#s4)

---

# <a id='s1' class='md-title' href='#top'>1. Servlet Reloading (Servlet 重載入)</a>

- 更改 **<span style='color:blue;'>WEB-INF/classes</span>** 底下之 Servlet 類別 (class) 檔後，不必重新啟動伺服器，伺服器會自動重新載入該 Servlet，稱之 **<span style='color:blue;'>Servlet Reloading</span>**
- 有些 Servlet Container 因考慮執行時整體效能的因素，可能會將此功能改為手動方式(例如 Tomcat)
- 被改為手動功能之 server 才需要做以下處理:
  - 每次啟動伺服器
  - **或** 將 server 的 X:\\{serve root}\\**conf**\\**server.xml** 加入 **<span style='color:red;'>reloadable="true"</span>**
    - `<Context path"/myWebApp" docBase="myWebApp" reloadable="true">`
  - Tomcat 6.x、7.x、8.x 另可方便的由
    X:\\{server root}\\**conf**\\**context.xml**
    一次設定 for 所有 Web App (主要使用此操作)
    - `<Context ... reloadable="true">`
  - **或** 由 manager 進入(見 [設定 Tomcat](./../03.環境準備/01.設定Tomcat.md) 內 manager 的設定)每次執行 reload 的動作，讓 myWebApp 當下重載入更動過的 Servlet

# <a id='s2' class='md-title' href='#top'>2. tomcat-users.xml 設定重載入</a>

- 角色權限說明
  - manager-gui: 允許訪問 html 接口(即 URL 路徑為/manager/html/)
  - manager-script: 允許訪問純文本接口(即 URL 路徑為/manager/text/)
  - manager-jmx: 允許訪問 JMX 代理接口(即 URL 路徑為/manager/jmxproxy/)
  - manager-status: 允許訪問 Tomcat 只讀狀態頁面(即 URL 路徑為/manager/status/)

```xml
<role rolename="manager-gui" />
<role rolename="manager-script" />
<user username="tomcat" password="tomcat" roles="manager-gui,manager-script" />
```

# <a id='s3' class='md-title' href='#top'>3. 手動 Reload 或 Stop</a>

- 手動在 Tomcat 點選 Reload 或 Stop 等等的按鈕即可重載

<p><img src='./image/01.Tomcat手動重載入.dio.svg'></p>

# <a id='s4' class='md-title' href='#top'>4. 重載入測試</a>

- 創建 java 檔
  - 此時頁面若執行 5 次則 count 會為 5
  - 設定重載入後，頁面若有修改資料，那 count 就會重新變成 0

```java
package servlet_examples;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorld extends HttpServlet {
  private static final long serialVersionUID = 1L;

  int count = 0;

  public void doGet(HttpServletRequest req, HttpServletResponse res)
                          throws ServletException, IOException {

    res.setContentType("text/html; charset=UTF-8");
    PrintWriter out = res.getWriter();

    out.println("<HTML>");
    out.println("<HEAD><TITLE>Hello World</TITLE></HEAD>");
    out.println("<BODY>");
    out.println("<BIG>Hello World , 世界你好 !</BIG>"+ (count++));
    out.println("</BODY></HTML>");
  }
}
```

- 修改 java 檔
  - 保存後 eclipse 會將 class 檔案更新

```java
    out.println("<BIG>Hello World World, 世界你好 !</BIG>"+ (count++));
```

- 重載入後
  - 此段 console 表示 servlet 已重載

```cs
Reloading Context with name [/myWebApp1] is completed
```

- 註:
  - eclipse 中有沒有添加 <u>重載入</u> 的設定都沒有差別是因為 <u>eclipse 本身就有額外設定重載入的功能，幫助開發專案</u>
  - 如果在 Tomcat 中，或在其它沒有預設重載入功能的編輯器上，就要設定 <u>reloadable="true"</u>，或手動在 Tomcat 介面上按 Reload 的動作

---

參考鏈接:

- [tomcat 实现热部署的配置](https://www.cnblogs.com/hellxz/p/7498859.html)
- [Maven 添加 Tomcat 插件實現熱部署代碼實例](https://www.jb51.net/article/184224.htm)
- [浅谈 Tomcat7 的热部署](https://kknews.cc/code/42rnegg.html)
