<h1 id="top">目錄</h1>

- [1. Init Parameter 初始參數](#s1)
- [2. context-param 環境初始參數](#s2)
- [3. Init Parameter 在 init() 中測試](#s3)
- [4. Init Parameter 在 doGet() 中測試](#s4)
- [5. context-param 測試](#s5)

---

# <a id='s1' class='md-title' href='#top'>1. Init Parameter 初始參數</a>

- 又稱做**區域配置**
- **設定: web.xml 檔案設定如下**
  - <u>servlet-name</u> : 註冊名稱
  - <u>servlet-calss</u> : 類別名稱
    - ch03.MyCounter : {package name}.{class name}
  - <u>url-pattern</u> :
    - /MyCounter1 : 明確對應
      - 詳細對應方法可參照 [佈署描述檔 web.xml 設定](./../11.WebApplication環境佈署/04.佈署描述檔Web.xml.md#s1)
    - MyCounter1 : 註冊名稱實體

```xml
<servlet>
  <servlet-name>MyCounter</servlet-name>
  <servlet-calss>ch03.MyCounter</servlet-calss>
  <init-param>
    <param-name>initial</param-name>
    <param-value>1000</param-name>
  </init-param>
</servlet>
<servlet-mapping>
  <servlet-name>MyCounter</servlet-name>
  <url-pattern>/MyCounter1</url-pattern>
</servlet-mapping>
```

- **主要的程式碼片段如下**
  - **設置方法**
    - 設定初始化時取得的參數名稱與值
    - 可設定多組，param-name 需不同名稱
  - **設置說明**
    - InitParameter 在 xml 設定中是為 MyCounter 此 servlet 所設定的參數，故又稱 <u>局部配置</u> ， 即 <u>MyCounter 的配置</u>

```xml
...
<init-param>
  <param-name>initial</param-name>
  <param-value>1000</param-name>
</init-param>
...
```

- **程式**:
  - 在 Servlet 的 **<span style='color:red;'>init()</span>** method 內以
    String **<span style='color:blue;'>initial_value</span>** = **<span style='color:red;'>getInitParameter</span>**("**<span style='color:#d23200;'>initial</span>**");
    取得初始參數的值，使用此用法則會 <u>在 servlet 初使化時才使用</u>
  - 而 getInitParameter 也可在其他方法中直接使用，即在 **<span style='color:red;'>doGet()</span>** method 內以
    String **<span style='color:blue;'>initial_value</span>** = **<span style='color:red;'>getInitParameter</span>**("**<span style='color:#d23200;'>initial</span>**");
    取得初始參數的值

# <a id='s2' class='md-title' href='#top'>2. context-param 環境初始參數</a>

- 又稱**全域配置**
- **設定**: web.xml 如下
  - global 名稱可自訂

```xml
<context-param>
  <param-name>global</param-name>
  <param-value>Okes</param-value>
</context-param>
```

- **使用方法**:
  用 **<span style='color:red;'>getServletContext</span>**().**<span style='color:red;'>getInitParameter</span>**("**<span style='color:#d23200;'>golbal</span>**") 方式取得參數值

# <a id='s3' class='md-title' href='#top'>3. Init Parameter 在 init() 中測試</a>

- **WEB-INF**/web.xml 設定 init-param 參數

```xml
<servlet>
  <servlet-name>HelloWorld</servlet-name>
  <servlet-class>servlet_examples.HelloWorld</servlet-class>
  <init-param>
    <param-name>initial</param-name>
    <param-value>1000</param-value>
  </init-param>
  <init-param>
    <param-name>initial2</param-name>
    <param-value>2000</param-value>
  </init-param>
</servlet>
<servlet-mapping>
  <servlet-name>HelloWorld</servlet-name>
  <url-pattern>/HelloWorld</url-pattern>
</servlet-mapping>
```

- 取得參數

```java
package servlet_examples;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorld extends HttpServlet {
  private static final long serialVersionUID = 1L;

  int count = 0;

  public void init() throws ServletException {
    System.out.println("Test from init...");
    // 不可定義參數為 Integer 型態，因 getInitParameter() 接收到的型態為 String
    String initial1 = getInitParameter("initial");
    String initial2 = getInitParameter("initial2");
    // 若 key 值打錯，或找不到值則將 count 還原成原來的 0
    try {
      // 將字串轉為整數後相加
      count = Integer.parseInt(initial1)+Integer.parseInt(initial2);
    }catch (NumberFormatException e){
      count = 0;
    }
  }

  public void doGet(HttpServletRequest req, HttpServletResponse res)
                          throws ServletException, IOException {

    res.setContentType("text/html; charset=UTF-8");
    PrintWriter out = res.getWriter();

    out.println("<HTML>");
    out.println("<HEAD><TITLE>Hello World</TITLE></HEAD>");
    out.println("<BODY>");
    out.println("<BIG>Hello World World , 世界你好 !</BIG>"+ (count++));
    out.println("</BODY></HTML>");
  }
}
```

- **執行結果**

```cs
Test from init...
Hello World World , 世界你好 !3000
```

# <a id='s4' class='md-title' href='#top'>4. Init Parameter 在 doGet() 中測試</a>

- **WEB-INF**/web.xml **設定 init-param 參數**

```xml
<servlet>
  <servlet-name>HelloWorld</servlet-name>
  <servlet-class>servlet_examples.HelloWorld</servlet-class>
  <init-param>
    <param-name>initial</param-name>
    <param-value>1000</param-value>
  </init-param>
  <init-param>
    <param-name>initial2</param-name>
    <param-value>2000</param-value>
  </init-param>
</servlet>
<servlet-mapping>
  <servlet-name>HelloWorld</servlet-name>
  <url-pattern>/HelloWorld</url-pattern>
</servlet-mapping>
```

- **修改 java 內容**

```java
package servlet_examples;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorld extends HttpServlet {
  private static final long serialVersionUID = 1L;

  int count = 0;

  public void doGet(HttpServletRequest req, HttpServletResponse res)
                          throws ServletException, IOException {

    String initial1 = getInitParameter("initial");
    String initial2 = getInitParameter("initial2");

    System.out.println(initial1);
    System.out.println(initial2);

    System.out.println("Hello World World , 世界你好 !"+ (count++));
  }

}
```

- **執行結果**

```cs
1000
2000
Hello World World , 世界你好 !0
1000
2000
Hello World World , 世界你好 !1
1000
2000
Hello World World , 世界你好 !2
1000
2000
Hello World World , 世界你好 !3
1000
2000
Hello World World , 世界你好 !4
```

- **結論** : 設定好後一率使用 getInitParameter() 方法取值就好

# <a id='s5' class='md-title' href='#top'>5. context-param 測試</a>

- **設置 context-param 在文件中任意位置**

```xml
...
<resource-ref>
  <description>DB Connection</description>
  <res-ref-name>jdbc/TestDB</res-ref-name>
  <res-type>javax.sql.DataSource</res-type>
  <res-auth>Container</res-auth>
</resource-ref>
<context-param>
  <param-name>global</param-name>
  <param-value>Okes</param-value>
</context-param>

<servlet>
  <servlet-name>HelloWorld</servlet-name>
  <servlet-class>servlet_examples.HelloWorld</servlet-class>
  <init-param>
    <param-name>initial</param-name>
    <param-value>1000</param-value>
  </init-param>
  <init-param>
    <param-name>initial2</param-name>
    <param-value>2000</param-value>
  </init-param>
</servlet>
<servlet-mapping>
  <servlet-name>HelloWorld</servlet-name>
  <url-pattern>/HelloWorld</url-pattern>
</servlet-mapping>
```

```java
package servlet_examples;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorld extends HttpServlet {
  private static final long serialVersionUID = 1L;

  int count = 0;

  public void init() throws ServletException {
    System.out.println("Test from init...");
  }

  public void doGet(HttpServletRequest req, HttpServletResponse res)
                          throws ServletException, IOException {

      String initial1 = getInitParameter("initial");
      String initial2 = getInitParameter("initial2");

      System.out.println(initial1);
      System.out.println(initial2);

      // 獲得 "全域配置" 時的方法
      System.out.println(getServletContext().getInitParameter("global"));
      // getServletConfig 用於獲得 "區域配置"，但如要獲得 "區域配置" 則可直接省略 getServletConfig 方法，並使用 getInitParameter 撰寫
      System.out.println(getServletConfig().getInitParameter("initial"));


      System.out.println("Hello World World , 世界你好 !"+ (count++));
  }
}
```

---

參考鏈接:

- [关于 Servlet 的 getInitParameter 的使用](https://blog.51cto.com/793404905/1540259)
