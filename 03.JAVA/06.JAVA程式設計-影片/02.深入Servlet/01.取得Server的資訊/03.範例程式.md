<h1 id="top">目錄</h1>

- [1. getServletContext 範例程式](#s1)
- [2. getAttribute 與 setAttribute 測試](#s2)
- [3. getServletContext 範例](#s3)

---

# <a id='s1' class='md-title' href='#top'>1. getServletContext 範例程式</a>

- **範例程式** :

```cs
範例程式: "/WebApp_ch04/src/servlet_examples/ServerSnoop.java"
```

- **檔案內容** :

```java
package servlet_examples;

import java.io.*;
import java.util.*;
import javax.servlet.*;

// 此範例程式繼承至 GenericServlet，所以實現的方法為 service
// 若繼承至 HttpServlet，則實現的方法即為 doGet 或 doPost
public class ServerSnoop extends GenericServlet {
	private static final long serialVersionUID = 1L;

  public void service(ServletRequest req, ServletResponse res)
                             throws ServletException, IOException {
    res.setContentType("text/plain");
    PrintWriter out = res.getWriter();

    ServletContext context = getServletContext();
    out.println("req.getServerName(): " + req.getServerName());
    out.println("req.getServerPort(): " + req.getServerPort());

    out.println("context.getAttributeNames():");
    Enumeration en = context.getAttributeNames();
    while (en.hasMoreElements()) {
      String name = (String) en.nextElement();
      out.println("  context.getAttribute(\"" + name + "\"): " +
                     context.getAttribute(name));
    }
  }
}
```

- 在 **WEB-INF/web.xml** 使用<u> 明確對應 </u>的方式註冊 ServerSnoop

```xml
<servlet>
  <servlet-name>ServerSnoop</servlet-name>
  <servlet-class>servlet_examples.ServerSnoop</servlet-class>
</servlet>
<servlet-mapping>
  <servlet-name>ServerSnoop</servlet-name>
  <url-pattern>/ServerSnoop</url-pattern>
</servlet-mapping>
```

# <a id='s2' class='md-title' href='#top'>2. 將範例程式改繼承自 HttpServlet</a>

```java
package servlet_examples;

import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

// 與 GenericServlet 差異
public class ServerSnoop extends HttpServlet {
	private static final long serialVersionUID = 1L;

  // ServletRequest req, ServletResponse res 改為 HttpServletRequest req, HttpServletResponse res
  // 且 service 改為 doGet 或 doPost 即可
  // 也因 HttpServlet 繼承自 GenericServlet，所以 service 不改成 get 或 post 也行
  // 但不建議在繼承 HttpServlet 的情況改寫 service 因為它定義了 http 處理的基本流程，會處理 doGet 或 doPost 方法，所以一般才只去改寫 doGet 或 doPost
  public void doGet(HttpServletRequest req, HttpServletResponse res)
                             throws ServletException, IOException {
    res.setContentType("text/plain");
    PrintWriter out = res.getWriter();

    ServletContext context = getServletContext();
    out.println("req.getServerName(): " + req.getServerName());
    out.println("req.getServerPort(): " + req.getServerPort());

    out.println("context.getAttributeNames():");
    Enumeration en = context.getAttributeNames();
    while (en.hasMoreElements()) {
      String name = (String) en.nextElement();
      out.println("  context.getAttribute(\"" + name + "\"): " +
                     context.getAttribute(name));
    }
  }
}
```

# <a id='s3' class='md-title' href='#top'>3. getAttribute 與 setAttribute 測試</a>

- getServletContext 中的 attribute 資料只要伺服器不重啟，不管幾年<u>永遠都會在伺服器當中</u>，就算瀏覽器關閉也會保留; 並且在專案當中所有的 servlet 的 jsp 可共享的資料

  - **伺服器停止方法**:
    - Tomcat 點擊 shutdown.bat 或 點擊 X 關閉 startup.bat
    - Eclipst 點擊 Stop the server，或 Terminate
  - **額外說明**:
    - 單純的在 Eclipse 執行 Run on Server 並不算重啟伺服器，所以值會保留
    - 伺服器停止後 context 就會被消滅，下次打開 ServletContext_Get 就會是 null 值

- **getAttribute 測試**
  - 先執行此程式，則會因為沒有 myName1 的值而顯示 null

```java
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class ServletContext_Get extends HttpServlet {
  private static final long serialVersionUID = 1L;


  public void doGet(HttpServletRequest req, HttpServletResponse res)
      throws ServletException, IOException {

    res.setContentType("text/html; charset=UTF-8");
    PrintWriter out = res.getWriter();

    ServletContext context = getServletContext();
    Object myName1 = context.getAttribute("myName1");
    out.println(myName1);
  }
}
```

- **setAttribute 測試**
  - set 過後的值除非 server 停止否則不消失

```java
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class ServletContext_Set extends HttpServlet {
  private static final long serialVersionUID = 1L;


  public void doGet(HttpServletRequest req, HttpServletResponse res)
      throws ServletException, IOException {

    res.setContentType("text/html; charset=UTF-8");
    PrintWriter out = res.getWriter();

    ServletContext context = getServletContext();
        context.setAttribute("myName1","世界你好1");

  }
}
```

---

參考鏈接:

- [JSP 學習*9*第一支 Servlet 程式](https://tsuozoe.pixnet.net/blog/post/24234723)
