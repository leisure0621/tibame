<h1 id="top">目錄</h1>

- [1. MySQL8 連線池配置](#s1)

---

# <a id='s1' class='md-title' href='#top'>1. MySQL8 連線池配置</a>

- **匯入範例項目**

  - 請右鍵另開視窗下載 [WebApp_ch07_DataBase.war](./doc/WebApp_ch07_DataBase.war)

- **WEB-INF/lib** 引入 **mysql-connector-java-8.x.xx.jar**

  - jar 可另開連結，下載 [mysql-connector-java-8.0.21.jar](./doc/mysql-connector-java-8.0.21.jar)
  - 或至官網下載 [最新版](https://ithelp.ithome.com.tw/articles/10215425)

- **WEB-INF/web.xml 設定**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" version="3.1">
  ...

  <resource-ref>
    <description>DB Connection</description>
    <res-ref-name>jdbc/TestDB2</res-ref-name>
    <res-type>javax.sql.DataSource</res-type>
    <res-auth>Container</res-auth>
  </resource-ref>

  ...

</web-app>
```

- **Servers/context.xml 設定**

```xml
...

<Resource name="jdbc/TestDB2"
  auth="Container"
  type="javax.sql.DataSource"
  maxTotal="100"
  maxWaitMillis="10000"
  driverClassName="com.mysql.cj.jdbc.Driver"
  url="jdbc:mysql://localhost:3306/db01?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC"
  username="root" password="123456" maxActive="20" maxIdle="10"
  maxWait="-1"/>

...
```

- **java 連線測試**

```java
package servlet_examples;

import java.io.*;
import java.sql.*;
import javax.naming.Context;
import javax.servlet.*;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;
import javax.sql.DataSource;

@WebServlet("/DBEmpLookup4_JNDI")
public class DBEmpLookup4_JNDI extends HttpServlet {
  private static final long serialVersionUID = 1L;

  public void doGet(HttpServletRequest req, HttpServletResponse res)
      throws ServletException, IOException {

    Connection con = null;
    Statement stmt = null;
    ResultSet rs = null;

    res.setContentType("text/html; charset=UTF-8");
    PrintWriter out = res.getWriter();

    try {
      Context ctx = new javax.naming.InitialContext();
      DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/TestDB2");
      con = ds.getConnection();
      stmt = con.createStatement();
      rs = stmt.executeQuery("select empno, ename from EMP2");

      out.println("<HTML><HEAD><TITLE>Phonebook</TITLE></HEAD>");
      out.println("<BODY>");
      out.println("<UL>");
      while (rs.next()) {
        out.println("<LI>" + rs.getString("empno") + " "+ rs.getString("ename"));
      }
      out.println("</UL>");
      out.println("</BODY></HTML>");
    } catch (Exception e) {
      out.println("Exception caught: " + e.getMessage());
    } finally {
      try {
        if (con != null)
          con.close();
      } catch (SQLException ignored) {
      }
    }
  }
}
```

---

參考鏈接:

- [mysql 连接 url 中 useUnicode=true&characterEncoding=UTF-8 的作用](https://blog.csdn.net/afgasdg/article/details/6941712)
- [mysql8.0 在 eclipse 中通过 xml 文件配置数据库连接池](https://blog.csdn.net/MaYuKang/article/details/91185742)
