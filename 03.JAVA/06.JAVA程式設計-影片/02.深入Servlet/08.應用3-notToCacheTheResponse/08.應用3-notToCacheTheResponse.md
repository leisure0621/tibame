<h1 id="top">目錄</h1>

- [1. Tell the Browser not to cache the response](#s1)
- [2. 快取設定範例](#s2)
- [3. 在濾器中應用](#s3)

---

# <a id='s1' class='md-title' href='#top'>1. Tell the Browser not to cache the response</a>

- **<span style='color:blue;'>目的:</span>** 避免瀏覽器對文件的快取 (cache)
- **<span style='color:blue;'>實作方法:</span>** 搭配使用以下 3 種方法以避免瀏覽器對文件的快取
  - **<span style='color:red;'>res</span>.<span style='color:blue;'>setHeader(</span>"Cache-Control", "<span style='color:#d23200;'>no-store</span>"<span style='color:blue;'>)</span> // HTTP 1.1**
    - 如果將值設為 no-store，表示此文件不應該被快取，也不可以儲存在 proxy 伺服器當中
    - 若將值設為 no-cache，(則只) 表示此文件不應該被快取
  - **<span style='color:red;'>res</span>.<span style='color:blue;'>setHeader(</span>"Pragma", "<span style='color:#d23200;'>no-cache</span>"<span style='color:blue;'>)</span> // HTTP 1.0**
    - 唯一的合法值為 no-cache，表示此文件不應該被快取
  - **<span style='color:red;'>res</span>.<span style='color:blue;'>setHeader(</span>"Expires", <span style='color:#d23200;'>0</span><span style='color:blue;'>)</span>**
    - 指文件資訊失效的時間
    - 如果將值設定為 0 時，指該文件立即失效

# <a id='s2' class='md-title' href='#top'>2. 快取設定範例</a>

- **設定佈署描述檔，將範立程式設定明確對應路徑**

```xml
<servlet>
  <servlet-name>HelloWorld_Not_To_Cache</servlet-name>
  <servlet-class>servlet_examples.HelloWorld_Not_To_Cache</servlet-class>
</servlet>
<servlet-mapping>
  <servlet-name>HelloWorld_Not_To_Cache</servlet-name>
  <url-pattern>/HelloWorld_Not_To_Cache</url-pattern>
</servlet-mapping>
```

- **具體程式**

```java
package servlet_examples;

import java.io.*;

import javax.servlet.*;
import javax.servlet.http.*;

public class HelloWorld_Not_To_Cache extends HttpServlet {
  private static final long serialVersionUID = 1L;

  int count=0;

  public void doGet(HttpServletRequest req, HttpServletResponse res) throws ServletException, IOException {
    res.setContentType("text/html; charset=UTF-8");
    PrintWriter out = res.getWriter();

    res.setHeader("Cache-Control","no-store"); //HTTP 1.1
    res.setHeader("Pragma","no-cache");        //HTTP 1.0
    res.setDateHeader ("Expires", 0);

    out.println("<HTML>");
    out.println("<HEAD><TITLE>Hello World</TITLE></HEAD>");
    out.println("<BODY>");
    out.println("<BIG>Hello World , 世界你好 MyCounter=</BIG>" + (++count));
    out.println("</BODY></HTML>");
  }

}
```

- **測試方法**: 一開始執行時，從別的頁面跳回本頁應該不會計數，因為有快取。如果取消快取則會重覆計數。即取得網頁最新資料

- **使用時機**: 可用在濾器，這樣所有頁面的資料就會獲取最新資訊而不會被快取影響

# <a id='s3' class='md-title' href='#top'>3. 在濾器中應用</a>

- 濾器的撰寫

```java
package filters;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class CacheFilter implements Filter {

  private FilterConfig config;

  public void init(FilterConfig config) {
    this.config = config;
  }

  public void destroy() {
    config = null;
  }

  public void doFilter(ServletRequest request, ServletResponse response,
      FilterChain chain) throws ServletException, IOException {

    HttpServletRequest req = (HttpServletRequest) request;
    HttpServletResponse res = (HttpServletResponse) response;

    res.setHeader("Cache-Control","no-store"); //HTTP 1.1
    res.setHeader("Pragma","no-cache");        //HTTP 1.0
    res.setDateHeader ("Expires", 0);
  }
}
```

- 濾器的註冊

```xml
<filter>
  <filter-name>cacheFilter</filter-name>
  <filter-class>filters.CacheFilter</filter-class>
</filter>
<filter-mapping>
  <filter-name>cacheFilter</filter-name>
  <url-pattern>/front_end/*</url-pattern>
  <dispatcher>REQUEST</dispatcher>
  <dispatcher>FORWARD</dispatcher>
  <dispatcher>INCLUDE</dispatcher>
  <dispatcher>ERROR</dispatcher>
  <dispatcher>ASYNC</dispatcher>
</filter-mapping>
```
