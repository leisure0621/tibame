<h1 id="top">目錄</h1>

- [1. 錯誤處理](#s1)

---

# <a id='s1' class='md-title' href='#top'>1. 錯誤處理</a>

- **<span style='color:blue;'>目的:</span>** 處理客戶端的錯誤 (**4xx**); 伺服器端的錯誤 (**5xx**, 含 javax.servlet.**ServletException** 例外處理)
- **<span style='color:red;'>實作方法 1:</span> 例用狀態碼 (Status Code) 之設定，進行錯誤處理**
  - **<span style='color:blue;'>例如:</span>**
    - **Status code (404):**
      - **<span style='color:red;'>res</span>.sendError(<span style='color:#d23200;'>res.SC_NOT_FOUND</span>);**
      - **<span style='color:red;'>res</span>.sendError(<span style='color:#d23200;'>res.SC_NOT_FOUND</span>, "<span style='color:#d23200;'>客戶端錯誤，找不到指定的檔案</span>");**
    - **Status code (500):**
      - **<span style='color:red;'>res</span>.sendError(<span style='color:#d23200;'>res.SC_INTERNAL_SERVER_ERROR</span>);**
      - **<span style='color:red;'>res</span>.sendError(<span style='color:#d23200;'>res.SC_INTERNAL_SERVER_ERROR</span>, "<span style='color:#d23200;'>伺服端的錯誤</span>");**
  - **<span style='color:blue;'>結果: 伺服器會代為產生一個錯誤訊息網頁</span>**
- **<span style='color:red;'>實作方法 2:</span> 例用狀態碼 (Status Code) 之設定 + web.xml 檔案**
  - **<span style='color:blue;'>例如:</span> web.xml 檔案**
  - **<span style='color:blue;'>結果: 可取代伺服器代為產生的錯誤訊息網頁，該自訂網頁更具彈性</span>**
  - **<span style='color:blue;'>註:</span> 錯誤訊息頁面也可共用一個頁面，即將頁面導到指定畫面**

```xml
<web-app>
  <!-- error-page 錯誤網頁 -->
  <error-page>
    <error-code>400</error-code>
    <location>/error.html</location>
  </error-page>

  <error-page>
    <error-code>404</error-code>
    <location>/error.html</location>
  </error-page>

  <error-page>
    <error-code>500</error-code>
    <location>/error.html</location>
  </error-page>

  <error-page>
    <exception-type>javax.servlet.ServletException</exception-type>
    <location>/error.html</location>
  </error-page>
</web-app>
```

- **<span style='color:red;'>實作方法 3:</span> JSP 如果已指定 errPage，將具最高優先(優先於前面的 web.xml)**
  - **&lt;%@ page errorPage="<span style='color:#d23200;'>error.jsp</span>" %&gt; 【如: main.jsp】**
  - **&lt;%@ page isErrorPage="<span style='color:#d23200;'>true</span>" %&gt; 【如: error.jsp】**
    - 需設定為 true 才能成為 error page 頁面
- **<span style='color:red;'>補充 1: 例外(exception)及 javax.servlet.ServletException 之攔截</span>**
  - 只有繼承自 java.lang.**RuntimeException**; java.io.**IOException**; java.servlet.**ServletException** 之例外，才可以放手由服務器處理
- **<span style='color:red;'>補充 2: 日誌紀錄</span>**
  - Servlet 可把自己的動作和發生的錯誤紀錄於日誌檔(log file):
    - **void <span style='color:blue;'>log(String msg)</span>**
    - **void <span style='color:blue;'>log(String msg, Throwable t)</span>**
  - 介面 ServletContext 與類別 GenericServlet 皆有以上同名 log 方法
