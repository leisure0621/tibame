<h1 id="top">目錄</h1>

- [1. Get 方法](#s1)
- [2. Post 方法](#s2)
- [3. Ajax 方法](#s3)
- [4. Ajax 配合 java 的 json](#s4)

---

# <a id='s1' class='md-title' href='#top'>1. Get 方法</a>

- 創建 jsp

```cs
"/jQuery_Ajax/WebContent/NameCity.jsp"
```

```cs
<%@ page language="java" contentType="text/html; charset=UTF-8" %>
<%
  String name = request.getParameter("name");
  String city = request.getParameter("city");
  out.print("<p>Dear "+name+",</p>");
  out.print("<p>Jope you live well in"+city+".</p>");
%>
```

- 創建原生 js 的 get 請求

```cs
"/jQuery_Ajax/WebContent/NameCityXRGet.html"
```

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h2>Get Method Demo</h2>
    <div id="demo"></div>
    <script>
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
          document.getElementById('demo').innerHTML = xhttp.responseText;
        }
      };
      xhttp.open('GET', 'NameCity.jsp?name=Henry&city=Taipei', true);
      xhttp.send();
    </script>
  </body>
</html>
```

- 創建 jquery 的 get 請求

```cs
"/jQuery_Ajax/WebContent/NameCityGet.html"
```

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <h2>Get Method Demo</h2>
    <div id="demo"></div>
    <script>
      $.get('NameCity.jsp?name=Henry&city=Taipei', function (data, status) {
        if (status == 'success') {
          $('#demo').html(data);
        }
      });
    </script>
  </body>
</html>
```

# <a id='s2' class='md-title' href='#top'>2. Post 方法</a>

- post 方法 1

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h2>Get Method Demo</h2>
    <div id="demo"></div>
    <script>
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
          document.getElementById('demo').innerHTML = xhttp.responseText;
        }
      };
      xhttp.open('POST', 'NameCity.jsp?name=Henry&city=Taipei', true);
      xhttp.send();
    </script>
  </body>
</html>
```

- post 方法 2

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h2>Get Method Demo</h2>
    <div id="demo"></div>
    <script>
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
          document.getElementById('demo').innerHTML = xhttp.responseText;
        }
      };
      xhttp.open('POST', 'NameCity.jsp', true);
      xhttp.setRequestHeader(
        'Content-type',
        'application/x-www-form-urlencoded'
      );
      xhttp.send('name=Henry&city=Taipei');
    </script>
  </body>
</html>
```

- post 方法 3

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <h2>Get Method Demo</h2>
    <div id="demo"></div>
    <script>
      $.post(
        'NameCity.jsp',
        {
          name: 'Henry',
          city: 'Taipei',
        },
        function (data, status) {
          if (status == 'success') {
            $('#demo').html(data);
          }
        }
      );
    </script>
  </body>
</html>
```

- post 方法 4

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <h2>Get Method Demo</h2>
    <div id="demo"></div>
    <script>
      let data = {
        name: 'Henry',
        city: 'Taipei',
      };
      $.post('NameCity.jsp', data, function (data, status) {
        if (status == 'success') {
          $('#demo').html(data);
        }
      });
    </script>
  </body>
</html>
```

# <a id='s3' class='md-title' href='#top'>3. Ajax 方法</a>

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <button id="get">using get</button>
    <button id="post">using post</button>
    <h2>Get Method Demo</h2>
    <div id="demo"></div>

    <script>
      let data = {
        name: 'Henry',
        city: 'Taipei',
      };
      $('#get').click(function () {
        ajax('get', data);
      });
      $('#post').click(function () {
        ajax('post', data);
      });

      function ajax(type, data) {
        $.ajax({
          url: 'NameCity.jsp',
          type: type,
          data: data,
          success: function (data, status) {
            if (status == 'success') {
              $('#demo').html(data);
            }
          },
        });
      }
    </script>
  </body>
</html>
```

# <a id='s4' class='md-title' href='#top'>4. Ajax 配合 java 的 json</a>

- html 頁面

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AJAX</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
      table {
        border-collapse: collapse;
        border-spacing: unset;
      }
      table * {
        border: solid 1px #ddd;
      }
    </style>
  </head>
  <body>
    <p><b>Chose a name: </b></p>
    <select id="selector"></select>
    <br /><br />
    <table id="tableData">
      <tr>
        <th>empno</th>
        <th>ename</th>
      </tr>
    </table>
    <br /><br />
    <table id="tableData2">
      <tr>
        <th>empno</th>
        <th>ename</th>
      </tr>
    </table>

    <script>
      // header 資料
      let header = {
        cache: 'no-cache',
        credentials: 'same-origin',
        headers: {
          'user-agent': 'Mozilla/4.0 MDN Example',
          'content-type': 'application/json',
        },
        method: 'POST',
        mode: 'cors',
        redirect: 'follow',
        referrer: 'no-referrer',
      };

      // 異步傳輸
      fetch('SelectName.jsp', header)
        .then(function (response) {
          if (!response.ok) throw new Error(response.statusText);
          return response.json();
        })
        .then(function (json) {
          Object.keys(json.data).forEach(function (index) {
            selector.innerHTML += `<option value="${json.data[index].empno}">${json.data[index].ename}</option>`;
          });
          return json;
        })
        .then(function (json) {
          Object.keys(json.data).forEach(function (index) {
            $('#tableData').append(
              `<tr>
                <td>${json.data[index].empno}</td>
                <td>${json.data[index].ename}</td>
              </tr>`
            );
          });
        });

      // 異步傳輸
      $.ajax({
        url: 'SelectName.jsp',
        type: 'GET',
        dataType: 'json',
        success: function (data, status) {
          Object.keys(data.data).forEach(function (index) {
            $('#tableData2').append(
              `<tr>
                <td>${data.data[index].empno}</td>
                <td>${data.data[index].ename}</td>
              </tr>`
            );
          });
        },
      });
    </script>
  </body>
</html>
```

- jsp 連接資料庫
  - JSONObject 是使用額外的 jar 檔，是由外部人員撰寫的 package ，所以需要去找 package 並自行引入項目中

```java
<%@ page language="java" contentType="text/html; charset=UTF-8" import="java.sql.*, java.util.*, org.json.*" %>
<%

  Class.forName("oracle.jdbc.driver.OracleDriver");
  String connUrl = "jdbc:oracle:thin:@localhost:1521:xe";
  Connection conn = DriverManager.getConnection(connUrl, "david", "123456");

  String qruStmt = "SELECT * from employee";
  PreparedStatement stmt = conn.prepareStatement(qruStmt);
  ResultSet rs = stmt.executeQuery();



  List map = new ArrayList();
   while(rs.next()){
     Map mapData = new HashMap();
     mapData.put("ename", rs.getString("ename"));
     mapData.put("empno", rs.getString("empno"));
     map.add(mapData);
  }


   JSONObject jsonObjectJacky = new JSONObject();
   jsonObjectJacky.put("data", map);
   jsonObjectJacky.put("status", 200);
  out.print(jsonObjectJacky);
  conn.close();
%>
```

---

參考鏈接:

- [jquery 的 ajax 同步和非同步的理解及示例](https://codertw.com/%E5%89%8D%E7%AB%AF%E9%96%8B%E7%99%BC/386494/)
- [AJAX 與 Fetch API](https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/ajax_fetch.html)
- [使用 Fetch](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch)
- [使用 Promise](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises)
- [探索 ES6](https://wizardforcel.gitbooks.io/exploring-es6/md/24.1.html)
- [JavaScript Promise：簡介](https://developers.google.com/web/fundamentals/primers/promises?hl=zh-tw)
- [JSONObject、JSONArray](https://blog.csdn.net/lishuangzhe7047/article/details/28880009)
- [jar 包放置在 WEB-INF/lib 下和通过 Build Path 导入的区别是什么？](https://blog.csdn.net/Angelia620/article/details/86601206)
