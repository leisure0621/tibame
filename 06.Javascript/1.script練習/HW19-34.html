<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HW19-34</title>
    <style>
      * {
        font-family: 微軟正黑體;
      }
      .calendar {
        display: flex;
        flex-wrap: wrap;
      }
      body > div {
        margin: 15px 15px;
        width: 400px;
        text-align: center;
        margin-left: auto;
        margin-right: auto;
      }
      .calendar div {
        width: calc(100% / 7);
        padding: 5px 0px;
      }
      .calendar > div:nth-child(1),
      .calendar > div:nth-child(2),
      .calendar > div:nth-child(3),
      .calendar > div:nth-child(4),
      .calendar > div:nth-child(5),
      .calendar > div:nth-child(6),
      .calendar > div:nth-child(7) {
        background: cadetblue;
        color: white;
      }
      strong {
        color: cadetblue;
      }
      .select-month {
        display: flex;
        text-align: center;
        flex-wrap: wrap;
        background: white;
        color: black;
        transition: 1s;
        position: absolute;
        width: 400px;
        top: -100px;
        box-shadow: 0 3px 5px #ddd;
        border-radius: 5px;
      }
      .select-month > div {
        width: calc(100%/7);
        padding: 10px 0;
      }
      .section,
      .select-year {
        display: flex;
      }
      .select-year .section {
        width: 100%;
        justify-content: center;
        align-items: center;
      }
      .section > div {
        width: calc(100%/5);
      }
      .left, .right {
        width: 25px;
        height: 23px;
        background: cadetblue;
        color: rgba(255, 255, 255, 1);
        border-radius: 50%;
        line-height: 20px;
        text-align: center;
        margin: 10px 0;
        opacity: 0.55;
        border: 0;
        outline: none;
      }
      .active{
        color: cadetblue;
      }
    </style>
  </head>
  <body>
    <div class="selection-area">
      <div class="select-year">
        <button class="left">&lt;</button>
        <div class="section"></div>
        <button class="right">&gt;</button>
      </div>
      <div class="select-month"></div>
    </div>
    <div class="title"></div>
    <div class="calendar">
    </div>
    <script>
      let calendar = {
        title: document.querySelector('.title'),
        day: document.querySelector('.calendar'),
        month: document.querySelector('.selection-area .select-month'),
        year: document.querySelector('.selection-area .select-year'),
        isActive: false,    
        timer: {
          weeks: ['日', '一', '二', '三', '四', '五', '六'],
          months: ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二'],
          date: new Date(),
          formatDate: function(){
            calendar.timer.year = calendar.timer.date.getFullYear();
            calendar.timer.month = calendar.timer.date.getMonth()+1;
            calendar.timer.day = calendar.timer.date.getDay();
            calendar.timer.monthsDate = [
              31, calendar.timer.year % 4 === 0 || calendar.timer.year % 100 === 0? 29: 28, 31, 30, 31, 31, 30, 31, 30, 31, 30, 31,
            ];
          },
          calendarDay: function(date){
            calendar.timer.year = date.getFullYear();
            calendar.timer.day = date.getDay();
            // 修改月份
            calendar.title.innerHTML = `${calendar.timer.months[calendar.timer.month-1]}月`;
            // 添加周幾
            for (let i = 0; i < 7; i++) {
              calendar.day.innerHTML += `<div>${calendar.timer.weeks[i]}</div>`;
            }
            for (let i = 0; i < calendar.timer.day; i++) {
              calendar.day.innerHTML += `<div></div>`;
            }
            // 添加日期
            for (let i = 0; i < calendar.timer.monthsDate[calendar.timer.month-1]; i++) {
                calendar.day.innerHTML += `<div>${i + 1}</div>`;
            }
          },
          clear: function(){
            calendar.title.innerHTML = "";
            calendar.day.innerHTML = "";
          },
          calendarMonth: function(){
            for (let i = 0; i < calendar.timer.months.length; i++) {
              if(i === calendar.timer.month-1)
                calendar.month.innerHTML += `<div month="${i+1}" class="active">${calendar.timer.months[i]}月</div>`;
              else
                calendar.month.innerHTML += `<div month="${i+1}">${calendar.timer.months[i]}月</div>`;
            }
          },
          calendarYear: function(){
            calendar.year.querySelector('.section').innerHTML = `<div year="${calendar.timer.year}">${calendar.timer.year}</div>`;
          },
          addYear: function(){
            calendar.timer.year = parseInt(calendar.timer.year) + 1;
            calendar.timer.calendarYear();
            return calendar.timer.year;
          },
          reduceYear: function(){
            calendar.timer.year = parseInt(calendar.timer.year) - 1;
            calendar.timer.calendarYear();
            return calendar.timer.year;
          }
        }
      };
      
      calendar.timer.formatDate();
      // 放入年月選擇器      
      calendar.timer.calendarMonth();
      calendar.timer.calendarYear();
      calendar.timer.calendarDay(new Date(`${calendar.timer.year}/${calendar.timer.month}`));
      // 監聽月份
      calendar.month.addEventListener('click', function(e){
        calendar.isActive = false;
        calendar.month.style.top = `-100px`;
        // 清空月份class
        var elements = calendar.month.getElementsByClassName('active');
        while(elements.length > 0){
          elements[0].classList.remove('active');
        }
        calendar.timer.clear(); // 清空日曆
        e.target.className = "active"; // 當前月份
        calendar.timer.month = parseInt(e.target.attributes.month.value);
        calendar.timer.calendarDay(new Date(`${calendar.timer.year}/${calendar.timer.month}`));
      });      
      // 監聽年分
      calendar.year.querySelector('.left').addEventListener('click', function(){
        calendar.timer.clear();
        calendar.timer.calendarDay(new Date(`${calendar.timer.reduceYear()}/${calendar.timer.month}`));
      });      
      calendar.year.querySelector('.right').addEventListener('click', function(){
        calendar.timer.clear();
        calendar.timer.calendarDay(new Date(`${calendar.timer.addYear()}/${calendar.timer.month}`));
      });
      // 展開月份選擇
      calendar.year.querySelector('.section').addEventListener('click', function(){
        if(calendar.isActive){
          calendar.isActive = false;
          calendar.month.style.top = `-100px`;
        }else {
          calendar.isActive = true;
          calendar.month.style.top = `62px`;
        }
      })
    </script>
    </script>
  </body>
</html>
