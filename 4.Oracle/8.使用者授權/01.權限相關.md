# User 異動

- **SQL Developer**

- 以 DBA 身份新增 user 與密碼,建立預設與暫時表格空間

- 點選連線資料庫 > Other Users 右鍵 > Create User

  - USER 頁籤 > 填寫 User Name 與 Password > Default Tablespace
    選 USERS;Temporary Tablespace 選 TEMP
  - Granted Roles 頁籤 > 勾選 CONNECT 與 RESOURCE 方能連線
    與使用資源
  - System Priviledges 頁籤 > 勾選 CREATE TABLE 方能建立表格

- 修改 User 設定

  - 點選連線資料庫 > Other Users > 對指定 User 右鍵 > Edit User

- **SQL 語法**

- `新增 User`

```sql
CREATE USER user_name IDENTIFIED BY password
DEFAULT TABLESPACE tablespace_name
TEMPORARY TABLESPACE temp_tablespace_name
```

- 授權 `CONNECT` 與 `RESOURCE`<sup>RESOURCE 包含表格權限</sup> 權限方能連線與使用資源

  - `GRANT CONNECT TO user_name;`

    - SQL Plus:SQL> CONNECT user_name;

  - `GRANT RESOURCE TO user_name;`

- 授權 CREATE TABLE 權限方能建立表格

  - `GRANT CREATE TABLE TO user_name;`

- 查詢 CONNECT 與 RESOURCE 系統權限。DBA 開頭的表格需要 DBA 身份方能查詢

  - SELECT \_ FROM DBA_SYS_PRIVS WHERE GRANTEE = 'CONNECT';
  - SELECT \_ FROM DBA_SYS_PRIVS WHERE GRANTEE = 'RESOURCE';

- `修改 User 密碼` (以下 SQL 指令可以在 SQL Plus 或 SQL Developer 執行)

  - 使用 sysdba 登入後修改指定 user 密碼
    - 作業系統提示字元> sqlplus / as sysdba
    - SQL> `ALTER USER user_name IDENTIFIED BY "password";`
  - User 登入後修改自己密碼
    - 作業系統提示字元> sqlplus user_name/password
    - SQL> PASSWORD

- `刪除 user`

  - 先中斷連線,加上 CASCADE 是要連鎖刪除相關物件
    - `DROP USER user_name CASCADE;`

# 表格授權

- 授權指定表格的 SELECT 權限方能查詢

  - `GRANT SELECT ON table_name TO user_name;`

    - 測試時,連線改成指定的 SCHEMA,SQL 可以省掉輸入 SCHEMA 名稱的麻煩

      - `ALTER SESSION SET CURRENT_SCHEMA = BOOKSHOP;`

- 授權指定表格的所有權限

  - `GRANT ALL ON table_name TO user_name;`

# 查詢 User 權限

- user 查詢自己的系統、角色、表格權限

  - `SELECT * FROM USER_SYS_PRIVS;`
  - `SELECT * FROM USER_ROLE_PRIVS;`
  - `SELECT * FROM USER_TAB_PRIVS;`

- 查詢 user 系統、角色、表格權限。DBA 開頭的表格需要 `DBA 身份`方能查詢

  - `SELECT * FROM DBA_SYS_PRIVS WHERE GRANTEE = 'user_name';`
  - `SELECT * FROM DBA_ROLE_PRIVS WHERE GRANTEE = 'user_name';`
  - `SELECT * FROM DBA_TAB_PRIVS WHERE GRANTEE = 'user_name';`

# 撤銷表格授權

- 撤銷建立表格權限

  - `REVOKE CREATE TABLE FROM user_name;`

- 撤銷指定表格的 SELECT 權限

  - `REVOKE SELECT ON table_name FROM user_name;`

- 撤銷指定表格的所有權限

  - `REVOKE ALL ON table_name FROM user_name;`

# 建立表格的各種實際指令操作

```sql
-- CH8-1 User異動
-- 新增user，IDENTIFIED BY設定密碼，建立預設與暫時表格空間
---- CREATE USER 創帳號
---- IDENTIFIED BY 設定帳號的密碼
CREATE USER TEST1 IDENTIFIED BY TEST1
DEFAULT TABLESPACE "USERS"
TEMPORARY TABLESPACE "TEMP";

-- 授權CONNECT與RESOURCE權限方能連線與使用資源
GRANT CONNECT TO TEST1;
GRANT RESOURCE TO TEST1;

-- 授權CREATE TABLE權限方能建立表格
GRANT CREATE TABLE TO TEST1;

-- 登入新帳號測試可否建立表格
CREATE TABLE AUTHOR (
    AUTHOR_ID VARCHAR2(40) PRIMARY KEY NOT NULL,
    AUTHOR_NAME VARCHAR2(40) NOT NULL
);

DROP TABLE AUTHOR;

-- 查詢CONNECT與RESOURCE系統權限，DBA開頭的表格需要DBA身份方能查詢
SELECT * FROM DBA_SYS_PRIVS WHERE GRANTEE = 'CONNECT';
SELECT * FROM DBA_SYS_PRIVS WHERE GRANTEE = 'RESOURCE';
------------------------------------------------------------------------
-- 修改指定user密碼
ALTER USER TEST1 IDENTIFIED BY "TEST111";
-- 修改自己密碼
PASSWORD;
------------------------------------------------------------------------
-- 刪除user(要先中斷連線)，加上CASCADE是要連鎖刪除相關物件
DROP USER TEST1 CASCADE;
------------------------------------------------------------------------
------------------------------------------------------------------------
-- CH8-2 表格授權
-- 授權指定表格的SELECT權限方能查詢
GRANT SELECT ON BOOK TO TEST1;
GRANT SELECT ON PUBLISHER TO TEST1;

-- 測試時，TEST1連線改成指定的SCHEMA，SQL可以省掉輸入SCHEMA名稱的麻煩
ALTER SESSION SET CURRENT_SCHEMA = BOOKSHOP;

-- 取得指定表格的SELECT授權即可測試查詢功能
SELECT BOOK_NAME, PRICE, AUTHOR, PUBLISHER_NAME FROM BOOK B
JOIN PUBLISHER P ON B.PUBLISHER_ID = P.PUBLISHER_ID;

-- 授權指定表格的所有權限
GRANT ALL ON BOOK TO TEST1;
GRANT ALL ON PUBLISHER TO TEST1;

-- 取得指定表格的所有權限即可測試增刪改查功能
UPDATE PUBLISHER SET CONTACT = 'AAA' WHERE PUBLISHER_ID = 'P00X';
COMMIT;

-- 查詢修改結果
SELECT * FROM PUBLISHER;
------------------------------------------------------------------------
------------------------------------------------------------------------
-- CH8-3 查詢User權限
-- user查詢自己的系統、角色、表格權限
SELECT * FROM USER_SYS_PRIVS;
SELECT * FROM USER_ROLE_PRIVS;
SELECT * FROM USER_TAB_PRIVS;

-- 查詢user系統、角色、表格權限，DBA開頭的表格需要DBA身份方能查詢
SELECT * FROM DBA_SYS_PRIVS WHERE GRANTEE = 'TEST1';
SELECT * FROM DBA_ROLE_PRIVS WHERE GRANTEE = 'TEST1';
SELECT * FROM DBA_TAB_PRIVS WHERE GRANTEE = 'TEST1';
------------------------------------------------------------------------
------------------------------------------------------------------------
-- CH8-4 撤銷表格授權
-- 撤銷建立表格權限(同時撤銷CREATE TABLE與RESOURCE比較保險)
REVOKE CREATE TABLE FROM TEST1;
REVOKE RESOURCE FROM TEST1;

-- 撤銷指定表格的SELECT權限
REVOKE SELECT ON BOOK FROM TEST1;
REVOKE SELECT ON PUBLISHER FROM TEST1;

-- 撤銷指定表格的所有權限
REVOKE ALL ON BOOK FROM TEST1;
REVOKE ALL ON PUBLISHER FROM TEST1;
------------------------------------------------------------------------
```

---

參考鏈接:

- [結構化查詢語言 三大類型](https://ithelp.ithome.com.tw/articles/10155660)
