<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HW18-34</title>
    <style>
      * {
        font-family: 微軟正黑體;
      }
      body {
        background: #ffcf9a;
      }
      button {
        outline: none;
      }
      #app {
        width: 460px;
        padding: 15px;
        background: #ff8601;
        border-radius: 25px;
        box-shadow: inset 0px 4px 13px rgb(255, 251, 238),
          inset 0px -4px 8px rgb(179, 58, 12);
        margin: 34px auto;
        height: 500px;
      }
      #app .box {
        display: flex;
        flex-wrap: wrap;
        width: 440px;
        height: 380px;
        padding: 9px;
        background: #933208;
        border-radius: 25px;
        box-shadow: inset 3px 9px 7px rgba(29, 23, 16, 0.3),
          inset -3px -9px 8px rgba(29, 23, 16, 0.3);
      }
      #app .box > div {
        display: flex;
        width: 100px;
        height: 85px;
        justify-content: center;
        align-items: center;
        transition: 0.3s;
        margin: 5px;
        text-align: center;
        font-size: 14px;
        background: #fef1cc;
        border-radius: 25px;
        box-shadow: inset 3px -9px 7px rgba(255, 152, 0, 0.3),
          inset -3px -9px 8px rgba(255, 152, 0, 0.3);
        color: #dd8600;
        font-weight: bold;
      }
      #app .box div:nth-child(9) {
        margin-left: 225px;
      }
      #app .box div:nth-child(6) {
        position: absolute;
        margin-left: 114px;
        margin-top: 99px;
        width: 210px;
        height: 181px;
        background-color: #ff8601;
        background-image: linear-gradient(
          847deg,
          rgba(255, 255, 255, 0.3) 25%,
          transparent 25%,
          transparent 50%,
          rgba(255, 255, 255, 0.3) 50%,
          rgba(255, 255, 255, 0.3) 75%,
          transparent 75%,
          transparent
        );
        box-shadow: inset 3px -9px 7px rgba(147, 50, 8, 0.4),
          inset -3px -9px 8px rgba(147, 50, 8, 0.4),
          inset -3px 6px 8px rgba(147, 0, 8, 0.4);
        color: #fff;
        font-size: 32px;
      }
      #app .box div:nth-child(7) {
        margin-left: 225px;
      }
      #toClear,
      #toStart {
        margin-top: 40px;
        padding: 10px;
        border: 0;
        width: 100px;
        text-align: center;
        border-radius: 15px;
        background: #fef1cc;
        box-shadow: inset 3px -9px 7px rgba(255, 152, 0, 0.3),
          inset -3px -9px 8px rgba(255, 152, 0, 0.3);
        padding: 12px 0;
        margin-right: 3px;
        font-weight: bold;
        font-size: 16px;
      }
      #toStart {
        float: left;
        margin-left: 5px;
      }
      #toClear {
        float: right;
      }
      /* 金幣 */
      .corn {
        width: 25px;
        height: 25px;
        background: #ffe717;
        position: absolute;
        margin-top: -18px;
        border-radius: 50%;
        box-shadow: inset 3px -9px 7px rgba(255, 152, 0, 0.3),
          inset -3px -9px 8px rgba(255, 152, 0, 0.3);
      }
      .corn > div {
        width: 18px;
        height: 18px;
        margin: 4px auto;
        background: #ffa139;
        border-radius: 50%;
        box-shadow: inset 0px -2px 2px rgb(255, 235, 54);
        color: antiquewhite;
        font-size: 12px;
      }
      .corn + div {
        padding-top: 13px;
      }
      /* 發光的小燈泡 */
      .lamp .light {
        position: absolute;
        background: #fff;
        border-radius: 50%;
      }
      .lamp .light:nth-child(1) {
        margin-left: -24px;
        margin-top: 40px;
      }
      .lamp .light:nth-child(2) {
        margin-left: -24px;
        margin-top: 40px;
      }
      .lamp .light:nth-child(3) {
        margin-left: 40px;
        margin-top: -18px;
      }
      .lamp .light:nth-child(4) {
        margin-left: 96px;
        margin-top: -10px;
      }
      .lamp .light:nth-child(5) {
        margin-left: 176px;
        margin-top: -22px;
      }
      .lamp .light:nth-child(6) {
        margin-left: 468px;
        margin-top: 40px;
      }
      .lamp .light:nth-child(7) {
        margin-left: 435px;
        margin-top: -6px;
      }
      .lamp .light:nth-child(8) {
        margin-left: 376px;
        margin-top: -20px;
      }
      .lamp .light:nth-child(9) {
        margin-left: 300px;
        margin-top: -12px;
      }
      .lamp .light:nth-child(10) {
        margin-left: 243px;
        margin-top: -19px;
      }
      .lamp .light:nth-child(2n + 1) {
        box-shadow: 0 0 4px #fcffd4;
        background: #fcffd4;
        animation: light1 2s;
        animation-iteration-count: infinite;
        width: 10px;
        height: 10px;
      }
      .lamp .light:nth-child(2n) {
        box-shadow: 0 0 4px #fcffd4;
        width: 15px;
        height: 15px;
      }
      @keyframes light1 {
        0% {
          box-shadow: 0 0 4px #fcffd4;
        }
        50% {
          box-shadow: 0 0 13px #fcffd4;
        }
        100% {
          box-shadow: 0 0 4px #fcffd4;
        }
      }
    </style>
  </head>
  <body>
    <script>
      window.onload = function () {
        let div = document.getElementsByClassName('box')[0];
        // 抽獎結構
        for (let i = 0; i < 13; i++) {
          let money = (Math.ceil(Math.random() * 10) % 10) % 10;
          if (i === 5) {
            div.innerHTML += `<div></div>`;
          } else {
            div.innerHTML +=
              `<div>` +
              `${
                money > 0
                  ? `<div class="corn"><div>$</div></div><div class="text">${money}個金幣</div>`
                  : `<div class="text">謝謝參與</div>`
              }` +
              `</div>`;
          }
        }

        let lottery = {
          arr: [0, 1, 2, 3, 6, 8, 12, 11, 10, 9, 7, 4],
          toStart: document.getElementById('toStart'),
          toClear: document.getElementById('toClear'),
          item: document.querySelectorAll('.box > div'),
          ans: document.querySelector('#app .box div:nth-child(6)'),
          random: 0,
          bingo: 0,
          timmer: 1000 / 12,
          i: 0,
          clear: function () {
            // 清空所有顏色
            for (let i = 0; i < lottery.item.length; i++) {
              if (i !== 5) lottery.item[i].style.opacity = `${1}`;
            }
          },
          drow: function () {
            // 上色
            for (let j = 0; j < 6; j++) {
              lottery.item[
                lottery.arr[(lottery.i + j) % 12]
              ].style.opacity = `0.${14 - j}`;
            }
          },
          startRound: function () {
            lottery.i = 0;
            lottery.random = Math.ceil(Math.random() * 13 + 1);

            let start = setInterval(function () {
              // 修改顏色
              lottery.drow();
              if (lottery.i > 30) {
                clearInterval(start);
              }
              lottery.i++;
            }, lottery.timmer);

            let end = setInterval(function () {
              // 修改顏色
              lottery.drow();
              if (lottery.i > 30 + lottery.random) {
                clearInterval(end);
                for (let j = 0; j < 6; j++) {
                  if (j < 5) {
                    lottery.clear();
                  } else {
                    lottery.bingo = lottery.arr[(lottery.i + j - 1) % 12];

                    // 顯示中獎結果
                    lottery.item[lottery.bingo].style.color = '#000';
                    let text = lottery.item[lottery.bingo].querySelector(
                      '.text'
                    ).innerText;
                    // 插入中獎文字
                    if (text !== '謝謝參與') {
                      lottery.ans.innerHTML = '恭喜獲得<br>' + text;
                    } else {
                      lottery.ans.innerHTML = text;
                    }
                    lottery.ans.style.color = '#fff';
                    toClear.disabled = false;
                  }
                }
              }
              lottery.i++;
            }, lottery.timmer * 6);
          },
        };

        // 開始
        lottery.toStart.addEventListener('click', function () {
          lottery.toStart.disabled = true;
          lottery.toClear.disabled = true;
          lottery.startRound();
        });

        // 清空
        lottery.toClear.addEventListener('click', function () {
          lottery.toStart.disabled = false;
          lottery.ans.innerHTML = ``;
          lottery.item[lottery.bingo].style.color = `#dd8600`;
          lottery.clear();
        });
      };
    </script>

    <div id="app">
      <div class="lamp">
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
      </div>
      <div class="box"></div>
      <button id="toStart">搖獎</button>
      <button id="toClear">重來</button>
    </div>
  </body>
</html>
